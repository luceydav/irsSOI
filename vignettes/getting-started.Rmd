---
title: "Getting Started with IRS SOI Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started Working with IRS SOI Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = TRUE,
  fig.align="center",
  out.width = "100%"
)
```


```{r setup}
knitr::opts_chunk$set(echo = TRUE)
library(irs.soi)
```



The NBER [Individual Income Tax Statistics - ZIP Code](Individual Income Tax Statistics - ZIP Code) cleans the [IRS SOI data][https://www.irs.gov/statistics/soi-tax-stats-individual-income-tax-statistics-zip-code-data-soi] and makes the data from 2005-2016 available for download. We built a function `download_nber_data()` to download based on specified years. Each year takes about 1 minute and 75MB of data. If no path specified, makes a file called "data" in the working directory. 

```{r 'download-nber', eval=FALSE}
#Not run
download_nber_data(start_year = 2015, end_year = 2016)
```

The `load_soi()` function takes all the data in the specified folder, loads and row binds all years to return a data.table. Because of changes over time, annual data sometimes has different variable names and threshold for income bands. We have aggregated income bands where possible. For example, early years had separate bands for \<\$<10k and \<\$25k, and the later years have only \<\$25k, so we aggregated the two bands into one. We unfortunately also had to aggregate \<\$100k and \<\$250k, but this would have made a more meaningful high income category. We have also sometimes coalesced variables which were the same, but called different names over time.

```{r 'load-soi', eval=FALSE}
# Not run
path <- "./data/"
irs_app_data <- load_soi(path = path)
```

Load included sample data.table for the State of CT from 2005-2018 called `irs_app_data`.

```{r 'sample-CT-data', echo=TRUE}
data("irs_app_data")
```

Make a Summary `datatable` for the State of CT with the `make_summary_DT()` function.

```{r 'summary', echo=TRUE}
make_summary_DT(irs_app_data)
```

Make a graph of the aggregated AGI of the State of CT by income band with the `make_agi_graph()` function.

```{r 'plotly-agi', echo=TRUE}
make_agi_graph(irs_app_data)
```

Make a graph of the average Federal tax rate for the State of CT by income band with the `make_tax_graph()` function. 

```{r 'plotly-tax-rate', echo=TRUE}
make_tax_graph(irs_app_data)
```

We have made a public Shiny [IRS Tax Dashboard](https://luceyda.shinyapps.io/irs_dash/), which can be filtered by State, County, Post Office City and Zipcode. Once the geography is chosen, it is also possible to filter among the five income bands. Currently, the App has two tabs, one for the Summary Table and another for the AGI and tax rate graphs, but the data set is rich with more fields, such as mortgage and SALT deductions, dependents, Earned Income Credit by zipcode, which made it too large for us to include in the first iteration. We will be adding more in a future version, which will use our own as well `{golem}` package.
